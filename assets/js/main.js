// Language translations
const translations = {
    en: {
        testBanner: "TEST MODE: All payment links are for testing purposes only.",
        logoText: "Reviews Request Machine",
        navPackages: "Packages",
        navHowItWorks: "How it works",
        navCompliance: "Compliance",
        navFaq: "FAQs",
        navContact: "Contact",
        heroTitle: "Google Reviews Request Machine (EN/ES)",
        heroSubtitle: "Turn last month's happy customers into honest Google reviews—compliant, bilingual, live in 48 hours.",
        heroCtaStarter: "Get Starter – $99",
        heroCtaStandard: "Standard – $199",
        heroCtaPro: "Rush/Pro – $299",
        heroNote: "No incentives. No review gating. Fully compliant with Google's policies.",
        socialProofTitle: "Trusted by Businesses",
        socialProofSubtitle: "See what our clients say about our service",
        testimonial1: "The review request service helped us double our Google reviews in just one month. The bilingual emails were perfect for our diverse customer base.",
        testimonial1Role: "Restaurant Owner",
        testimonial2: "Compliance was our biggest concern, but they handled everything perfectly. No incentives, just honest requests to happy customers.",
        testimonial2Role: "Service Provider",
        testimonial3: "The setup was incredibly fast, and we started seeing results within days. The weekly summary reports are exactly what we needed.",
        testimonial3Role: "Retail Manager",
        packagesTitle: "Choose Your Package",
        packagesSubtitle: "One-time setup, no monthly fees",
        packageStarterName: "Starter",
        packageStarterFeature1: "Up to 100 review requests",
        packageStarterFeature2: "English or Spanish emails",
        packageStarterFeature3: "Basic customization",
        packageStarterFeature4: "48-hour setup",
        packageStarterCta: "Buy Now",
        packageStandardName: "Standard",
        packageStandardFeature1: "Up to 500 review requests",
        packageStandardFeature2: "Bilingual emails (EN + ES)",
        packageStandardFeature3: "Advanced customization",
        packageStandardFeature4: "24-hour setup",
        packageStandardFeature5: "Weekly summary reports",
        packageStandardCta: "Buy Now",
        packageProName: "Rush/Pro",
        packageProFeature1: "Unlimited review requests",
        packageProFeature2: "Bilingual emails (EN + ES)",
        packageProFeature3: "Premium customization",
        packageProFeature4: "Same-day setup",
        packageProFeature5: "Daily summary reports",
        packageProFeature6: "Priority support",
        packageProCta: "Buy Now",
        packageNote: "You'll complete a 3-minute onboarding after checkout.",
        howItWorksTitle: "How It Works",
        howItWorksSubtitle: "Simple process, great results",
        step1Title: "Buy + Onboarding",
        step1Desc: "Select your package and complete our simple 3-minute onboarding process.",
        step2Title: "We Send Requests",
        step2Desc: "We send personalized review requests to your customers with a polite follow-up reminder.",
        step3Title: "Get Results",
        step3Desc: "Receive weekly summary reports with your new review count and customer feedback.",
        complianceTitle: "Compliance Guaranteed",
        complianceSubtitle: "We follow Google's policies strictly",
        complianceIntro: "Our service is designed to be fully compliant with Google's review policies:",
        compliancePoint1: "No incentives",
        compliancePoint2: "No review gating",
        compliancePoint3: "We ask all recent customers politely",
        compliancePoint4: "Clear opt-out in every email",
        complianceConsent: "We only use consented contact lists provided by you.",
        complianceNote: "Google prohibits incentivized or gated reviews. Our service is designed to help you get honest reviews from happy customers without violating these policies.",
        complianceBilingual: "All emails can be in English, Spanish, or both languages based on your customers' preferences.",
        faqTitle: "Frequently Asked Questions",
        faqSubtitle: "Everything you need to know",
        faqQuestion1: "Is this service compliant with Google's policies?",
        faqAnswer1: "Yes, absolutely. We strictly follow Google's policies against incentivized or gated reviews. We simply send polite requests to your customers with a clear opt-out option. No incentives are offered, and we don't filter or gate any reviews.",
        faqQuestion2: "How quickly can I expect results?",
        faqAnswer2: "Most clients start seeing new reviews within 3-5 days of the first email send. The exact timeline depends on your industry, customer base, and the quality of your products or services. We typically see a 15-30% response rate from happy customers.",
        faqQuestion3: "What do I need to provide to get started?",
        faqAnswer3: "You'll need to provide: 1) Your Google review link or QR code, 2) A consented contact list of recent customers (email and/or phone), 3) Your preferred sender address and name, 4) Your logo and preferred brand tone for the emails.",
        faqQuestion4: "How is customer data handled?",
        faqAnswer4: "We take data privacy seriously. Customer information is used only for sending review requests and is never shared with third parties. After the campaign is complete (typically 30 days), all customer data is permanently deleted from our systems.",
        faqQuestion5: "What email domain will the requests come from?",
        faqAnswer5: "We can send emails from your own domain (requires simple DNS verification) or from our trusted sending domain. Using your own domain typically results in higher open rates and better brand recognition.",
        faqQuestion6: "What kind of results can I expect?",
        faqAnswer6: "Results vary by industry and customer satisfaction level, but our clients typically see a 15-30% response rate from satisfied customers. The key is providing a great product or service - we simply make it easy for happy customers to share their experience.",
        contactTitle: "Ready to Get Started?",
        contactSubtitle: "Have questions? Reach out to our team",
        contactEmail: "Email Us",
        contactOnboarding: "Start Onboarding",
        contactNote: "Note: Stripe test links are for preview purposes only.",
        footerCopyright: "© 2023 Reviews Request Machine. Google prohibits incentivized or gated reviews; we comply fully."
    },
    es: {
        testBanner: "MODO DE PRUEBA: Todos los enlaces de pago son solo para fines de prueba.",
        logoText: "Máquina de Solicitud de Reseñas",
        navPackages: "Paquetes",
        navHowItWorks: "Cómo funciona",
        navCompliance: "Cumplimiento",
        navFaq: "Preguntas",
        navContact: "Contacto",
        heroTitle: "Máquina de Solicitud de Reseñas de Google (EN/ES)",
        heroSubtitle: "Convierta a los clientes felices del mes pasado en reseñas honestas de Google—cumpliendo normas, bilingüe, activo en 48 horas.",
        heroCtaStarter: "Obtener Starter – $99",
        heroCtaStandard: "Estándar – $199",
        heroCtaPro: "Rush/Pro – $299",
        heroNote: "Sin incentivos. Sin filtrado de reseñas. Totalmente conforme con las políticas de Google.",
        socialProofTitle: "Confiado por Empresas",
        socialProofSubtitle: "Vea lo que nuestros clientes dicen sobre nuestro servicio",
        testimonial1: "El servicio de solicitud de reseñas nos ayudó a duplicar nuestras reseñas de Google en solo un mes. Los correos bilingües fueron perfectos para nuestra diversa base de clientes.",
        testimonial1Role: "Propietario de Restaurante",
        testimonial2: "El cumplimiento era nuestra mayor preocupación, pero manejaron todo perfectamente. Sin incentivos, solo solicitudes honestas a clientes satisfechos.",
        testimonial2Role: "Proveedor de Servicios",
        testimonial3: "La configuración fue increíblemente rápida y comenzamos a ver resultados en días. Los informes semanales eran exactamente lo que necesitábamos.",
        testimonial3Role: "Gerente de Retail",
        packagesTitle: "Elija Su Paquete",
        packagesSubtitle: "Configuración única, sin cargos mensuales",
        packageStarterName: "Starter",
        packageStarterFeature1: "Hasta 100 solicitudes de reseña",
        packageStarterFeature2: "Correos en inglés o español",
        packageStarterFeature3: "Personalización básica",
        packageStarterFeature4: "Configuración en 48 horas",
        packageStarterCta: "Comprar Ahora",
        packageStandardName: "Estándar",
        packageStandardFeature1: "Hasta 500 solicitudes de reseña",
        packageStandardFeature2: "Correos bilingües (EN + ES)",
        packageStandardFeature3: "Personalización avanzada",
        packageStandardFeature4: "Configuración en 24 horas",
        packageStandardFeature5: "Informes semanales",
        packageStandardCta: "Comprar Ahora",
        packageProName: "Rush/Pro",
        packageProFeature1: "Solicitudes de reseña ilimitadas",
        packageProFeature2: "Correos bilingües (EN + ES)",
        packageProFeature3: "Personalización premium",
        packageProFeature4: "Configuración el mismo día",
        packageProFeature5: "Informes diarios",
        packageProFeature6: "Soporte prioritario",
        packageProCta: "Comprar Ahora",
        packageNote: "Completará una incorporación de 3 minutos después del pago.",
        howItWorksTitle: "Cómo Funciona",
        howItWorksSubtitle: "Proceso simple, excelentes resultados",
        step1Title: "Compra + Incorporación",
        step1Desc: "Seleccione su paquete y complete nuestro simple proceso de incorporación de 3 minutos.",
        step2Title: "Enviamos Solicitudes",
        step2Desc: "Enviamos solicitudes de reseña personalizadas a sus clientes con un recordatorio de seguimiento educado.",
        step3Title: "Obtenga Resultados",
        step3Desc: "Reciba informes semanales con su recuento de nuevas reseñas y comentarios de clientes.",
        complianceTitle: "Cumplimiento Garantizado",
        complianceSubtitle: "Seguimos estrictamente las políticas de Google",
        complianceIntro: "Nuestro servicio está diseñado para ser totalmente conforme con las políticas de reseñas de Google:",
        compliancePoint1: "Sin incentivos",
        compliancePoint2: "Sin filtrado de reseñas",
        compliancePoint3: "Solicitamos educadamente a todos los clientes recientes",
        compliancePoint4: "Opción clara de exclusión en cada correo",
        complianceConsent: "Solo usamos listas de contactos consentidas proporcionadas por usted.",
        complianceNote: "Google prohíbe las reseñas incentivadas o filtradas. Nuestro servicio está diseñado para ayudarle a obtener reseñas honestas de clientes satisfechos sin violar estas políticas.",
        complianceBilingual: "Todos los correos pueden estar en inglés, español o ambos idiomas según las preferencias de sus clientes.",
        faqTitle: "Preguntas Frecuentes",
        faqSubtitle: "Todo lo que necesita saber",
        faqQuestion1: "¿Este servicio cumple con las políticas de Google?",
        faqAnswer1: "Sí, absolutamente. Seguimos estrictamente las políticas de Google contra las reseñas incentivadas o filtradas. Simplemente enviamos solicitudes educadas a sus clientes con una opción clara de exclusión. No se ofrecen incentivos y no filtramos ni seleccionamos ninguna reseña.",
        faqQuestion2: "¿Qué tan rápido puedo esperar resultados?",
        faqAnswer2: "La mayoría de los clientes comienzan a ver nuevas reseñas dentro de los 3-5 días posteriores al primer envío de correo. El cronograma exacto depende de su industria, base de clientes y la calidad de sus productos o servicios. Normalmente vemos una tasa de respuesta del 15-30% de clientes satisfechos.",
        faqQuestion3: "¿Qué necesito proporcionar para comenzar?",
        faqAnswer3: "Necesitará proporcionar: 1) Su enlace o código QR de reseña de Google, 2) Una lista de contactos consentidos de clientes recientes (correo electrónico y/o teléfono), 3) Su dirección y nombre de remitente preferidos, 4) Su logotipo y tono de marca preferido para los correos.",
        faqQuestion4: "¿Cómo se manejan los datos de los clientes?",
        faqAnswer4: "Nos tomamos la privacidad de los datos en serio. La información del cliente se usa solo para enviar solicitudes de reseña y nunca se comparte con terceros. Después de que la campaña se completa (típicamente 30 días), todos los datos del cliente se eliminan permanentemente de nuestros sistemas.",
        faqQuestion5: "¿Desde qué dominio de correo electrónico vendrán las solicitudes?",
        faqAnswer5: "Podemos enviar correos desde su propio dominio (requiere simple verificación DNS) o desde nuestro dominio de envío confiable. Usar su propio dominio generalmente resulta en mayores tasas de apertura y mejor reconocimiento de marca.",
        faqQuestion6: "¿Qué tipo de resultados puedo esperar?",
        faqAnswer6: "Los resultados varían según la industria y el nivel de satisfacción del cliente, pero nuestros clientes típicamente ven una tasa de respuesta del 15-30% de clientes satisfechos. La clave es proporcionar un excelente producto o servicio; simplemente facilitamos que los clientes satisfechos compartan su experiencia.",
        contactTitle: "¿Listo para Empezar?",
        contactSubtitle: "¿Tiene preguntas? Comuníquese con nuestro equipo",
        contactEmail: "Envíenos un Correo",
        contactOnboarding: "Comenzar Incorporación",
        contactNote: "Nota: Los enlaces de prueba de Stripe son solo para fines de vista previa.",
        footerCopyright: "© 2023 Máquina de Solicitud de Reseñas. Google prohíbe las reseñas incentivadas o filtradas; cumplimos totalmente."
    }
};

// Initialize language
let currentLang = localStorage.getItem('preferredLang') || 'en';

// DOM Elements
const langOptions = document.querySelectorAll('.lang-option');
const elementsWithDataLang = document.querySelectorAll('[data-lang]');
const faqQuestions = document.querySelectorAll('.faq-question');
const backToTopBtn = document.getElementById('backToTop');
const header = document.getElementById('header');
const ctaButtons = document.querySelectorAll('.btn');
const packageCards = document.querySelectorAll('.package-card');

// Language toggle functionality
function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('preferredLang', lang);

    // Update active language option
    langOptions.forEach(option => {
        if (option.dataset.lang === lang) {
            option.classList.add('active');
        } else {
            option.classList.remove('active');
        }
    });

    // Update all elements with data-lang attribute
    elementsWithDataLang.forEach(element => {
        const key = element.dataset.lang;
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });

    // Update HTML lang attribute
    document.documentElement.lang = lang;
}

// Language option click handlers
langOptions.forEach(option => {
    option.addEventListener('click', () => {
        setLanguage(option.dataset.lang);
    });
});

// Initialize language
setLanguage(currentLang);

// FAQ accordion functionality
faqQuestions.forEach(question => {
    question.addEventListener('click', () => {
        const faqItem = question.parentElement;
        const isActive = faqItem.classList.contains('active');

        // Close all FAQ items
        document.querySelectorAll('.faq-item').forEach(item => {
            item.classList.remove('active');
            item.querySelector('.faq-question').setAttribute('aria-expanded', 'false');
        });

        // Open clicked item if it wasn't active
        if (!isActive) {
            faqItem.classList.add('active');
            question.setAttribute('aria-expanded', 'true');
        }
    });
});

// Back to top button functionality
window.addEventListener('scroll', () => {
    if (window.pageYOffset > 900) {
        backToTopBtn.classList.add('visible');
    } else {
        backToTopBtn.classList.remove('visible');
    }

    // Shrink header on scroll
    if (window.pageYOffset > 100) {
        header.classList.add('shrink');
    } else {
        header.classList.remove('shrink');
    }
});

backToTopBtn.addEventListener('click', () => {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
});

// Button ripple effect
function createRipple(event) {
    const button = event.currentTarget;
    const circle = document.createElement('span');
    const diameter = Math.max(button.clientWidth, button.clientHeight);
    const radius = diameter / 2;

    circle.style.width = circle.style.height = `${diameter}px`;
    circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
    circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
    circle.classList.add('ripple');

    const ripple = button.getElementsByClassName('ripple')[0];
    if (ripple) {
        ripple.remove();
    }

    button.appendChild(circle);
}

ctaButtons.forEach(button => {
    button.addEventListener('click', createRipple);
});

// Confetti effect for CTA buttons
function createConfetti(event) {
    const button = event.currentTarget;
    const buttonRect = button.getBoundingClientRect();
    const colors = ['#6366f1', '#8b5cf6', '#ec4899', '#f43f5e', '#10b981'];

    // Only create confetti for primary CTA buttons
    if (!button.classList.contains('btn-primary') && !button.classList.contains('btn-secondary')) {
        return;
    }

    for (let i = 0; i < 30; i++) {
        setTimeout(() => {
            const confettiPiece = document.createElement('div');
            confettiPiece.classList.add('confetti');
            confettiPiece.style.left = `${buttonRect.left + buttonRect.width / 2}px`;
            confettiPiece.style.top = `${buttonRect.top + buttonRect.height / 2}px`;
            confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confettiPiece.style.width = `${Math.random() * 10 + 5}px`;
            confettiPiece.style.height = confettiPiece.style.width;

            // Random horizontal movement (CSS var used in keyframes if needed)
            const horizontalMovement = (Math.random() - 0.5) * 200;
            confettiPiece.style.setProperty('--horizontal-movement', `${horizontalMovement}px`);

            document.body.appendChild(confettiPiece);

            // Remove confetti after animation completes
            setTimeout(() => {
                confettiPiece.remove();
            }, 3000);
        }, i * 30);
    }
}

// Add confetti to CTA buttons
document.querySelectorAll('.hero-cta .btn').forEach(button => {
    button.addEventListener('click', createConfetti);
});

// Magnetic hover effect for buttons
function addMagneticEffect() {
    const buttons = document.querySelectorAll('.btn');

    buttons.forEach(button => {
        button.addEventListener('mousemove', (e) => {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const rect = button.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;

            // Move button towards cursor
            button.style.transform = `translate(${x * 0.2}px, ${y * 0.2}px)`;
        });

        button.addEventListener('mouseleave', () => {
            button.style.transform = '';
        });
    });
}

// Card tilt effect
function addCardTiltEffect() {
    const cards = document.querySelectorAll('.package-card');
    cards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateX = (y - centerY) / 10;
            const rotateY = (centerX - x) / 10;

            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-10px)`;
        });

        card.addEventListener('mouseleave', () => {
            card.style.transform = '';
        });
    });
}

// Initialize Lottie animation
function initLottie() {
    const animationContainer = document.getElementById('heroLottie');

    // Using a lightweight abstract success animation from LottieFiles
    lottie.loadAnimation({
        container: animationContainer,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'https://assets9.lottiefiles.com/packages/lf20_1pxqjqps.json'
    });
}

// GSAP animations
function initGSAPAnimations() {
    // Register ScrollTrigger plugin
    if (window.gsap && window.ScrollTrigger) {
        gsap.registerPlugin(ScrollTrigger);
    }

    // Reveal animations for sections
    gsap.utils.toArray('.social-proof, .packages, .how-it-works, .compliance, .faq, .contact').forEach(section => {
        gsap.fromTo(section,
            { opacity: 0, y: 50 },
            {
                opacity: 1,
                y: 0,
                duration: 1,
                scrollTrigger: {
                    trigger: section,
                    start: 'top 80%',
                    end: 'bottom 20%',
                    toggleActions: 'play none none reverse'
                }
            }
        );
    });

    // Testimonial cards animation
    gsap.utils.toArray('.testimonial-card').forEach((card, i) => {
        gsap.fromTo(card,
            { opacity: 0, y: 30 },
            {
                opacity: 1,
                y: 0,
                duration: 0.6,
                delay: i * 0.1,
                scrollTrigger: {
                    trigger: card,
                    start: 'top 85%'
                }
            }
        );
    });

    // Package cards animation
    gsap.utils.toArray('.package-card').forEach((card, i) => {
        gsap.fromTo(card,
            { opacity: 0, y: 30 },
            {
                opacity: 1,
                y: 0,
                duration: 0.6,
                delay: i * 0.1,
                scrollTrigger: {
                    trigger: card,
                    start: 'top 85%'
                }
            }
        );
    });

    // Steps animation
    gsap.utils.toArray('.step').forEach((step, i) => {
        gsap.fromTo(step,
            { opacity: 0, scale: 0.9 },
            {
                opacity: 1,
                scale: 1,
                duration: 0.6,
                delay: i * 0.2,
                scrollTrigger: {
                    trigger: step,
                    start: 'top 85%'
                }
            }
        );
    });

    // Hero text animation
    gsap.fromTo('.hero-text',
        { opacity: 0, x: -50 },
        {
            opacity: 1,
            x: 0,
            duration: 1,
            delay: 0.3
        }
    );

    // Hero Lottie animation
    gsap.fromTo('.hero-lottie',
        { opacity: 0, x: 50 },
        {
            opacity: 1,
            x: 0,
            duration: 1,
            delay: 0.5
        }
    );

    // Parallax effect for hero background layers
    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        gsap.to('.layer-1', {
            y: -100,
            scrollTrigger: {
                trigger: '.hero',
                start: 'top top',
                end: 'bottom top',
                scrub: true
            }
        });

        gsap.to('.layer-2', {
            y: -150,
            scrollTrigger: {
                trigger: '.hero',
                start: 'top top',
                end: 'bottom top',
                scrub: true
            }
        });
    }
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    initLottie();
    initGSAPAnimations();
    addMagneticEffect();
    addCardTiltEffect();
});

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            window.scrollTo({
                top: target.offsetTop - 80,
                behavior: 'smooth'
            });
        }
    });
});
